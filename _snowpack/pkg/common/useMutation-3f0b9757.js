import{b as L,i as y,e as b,d as m,_ as p,m as P,f as Q,N as O}from"./index-8ed85517.js";import{r as d}from"./index-927aee77.js";var x=new(L?WeakMap:Map);function k(){var o=x.get(d.createContext);return o||(o=d.createContext({}),o.displayName="ApolloContext",x.set(d.createContext,o)),o}var f;(function(o){o[o.Query=0]="Query",o[o.Mutation=1]="Mutation",o[o.Subscription=2]="Subscription"})(f||(f={}));var w=new Map;function D(o){var e;switch(o){case f.Query:e="Query";break;case f.Mutation:e="Mutation";break;case f.Subscription:e="Subscription";break}return e}function N(o){var e=w.get(o);if(e)return e;var t,s,n;y(!!o&&!!o.kind,34);var u=o.definitions.filter(function(h){return h.kind==="FragmentDefinition"}),i=o.definitions.filter(function(h){return h.kind==="OperationDefinition"&&h.operation==="query"}),r=o.definitions.filter(function(h){return h.kind==="OperationDefinition"&&h.operation==="mutation"}),a=o.definitions.filter(function(h){return h.kind==="OperationDefinition"&&h.operation==="subscription"});y(!u.length||i.length||r.length||a.length,35),y(i.length+r.length+a.length<=1,36),s=i.length?f.Query:f.Mutation,!i.length&&!r.length&&(s=f.Subscription);var l=i.length?i:r.length?r:a;y(l.length===1,37);var c=l[0];t=c.variableDefinitions||[],c.name&&c.name.kind==="Name"?n=c.name.value:n="data";var v={name:n,type:s,variables:t};return w.set(o,v),v}var M=function(){function o(e,t){this.isMounted=!1,this.previousOptions={},this.context={},this.options={},this.options=e||{},this.context=t||{}}return o.prototype.getOptions=function(){return this.options},o.prototype.setOptions=function(e,t){t===void 0&&(t=!1),t&&!b(this.options,e)&&(this.previousOptions=this.options),this.options=e},o.prototype.unmount=function(){this.isMounted=!1},o.prototype.refreshClient=function(){var e=this.options&&this.options.client||this.context&&this.context.client;y(!!e,29);var t=!1;return e!==this.client&&(t=!0,this.client=e,this.cleanup()),{client:this.client,isNew:t}},o.prototype.verifyDocumentType=function(e,t){var s=N(e);D(t),D(s.type),y(s.type===t,30)},o}();(function(o){m(e,o);function e(t){var s=t.options,n=t.context,u=t.setResult,i=o.call(this,s,n)||this;return i.currentObservable={},i.setResult=u,i.initialize(s),i}return e.prototype.execute=function(t){if(this.getOptions().skip===!0)return this.cleanup(),{loading:!1,error:void 0,data:void 0,variables:this.getOptions().variables};var s=t;this.refreshClient().isNew&&(s=this.getLoadingResult());var n=this.getOptions().shouldResubscribe;return typeof n=="function"&&(n=!!n(this.getOptions())),n!==!1&&this.previousOptions&&Object.keys(this.previousOptions).length>0&&(this.previousOptions.subscription!==this.getOptions().subscription||!b(this.previousOptions.variables,this.getOptions().variables)||this.previousOptions.skip!==this.getOptions().skip)&&(this.cleanup(),s=this.getLoadingResult()),this.initialize(this.getOptions()),this.startSubscription(),this.previousOptions=this.getOptions(),p(p({},s),{variables:this.getOptions().variables})},e.prototype.afterExecute=function(){this.isMounted=!0},e.prototype.cleanup=function(){this.endSubscription(),delete this.currentObservable.query},e.prototype.initialize=function(t){this.currentObservable.query||this.getOptions().skip===!0||(this.currentObservable.query=this.refreshClient().client.subscribe({query:t.subscription,variables:t.variables,fetchPolicy:t.fetchPolicy}))},e.prototype.startSubscription=function(){this.currentObservable.subscription||(this.currentObservable.subscription=this.currentObservable.query.subscribe({next:this.updateCurrentData.bind(this),error:this.updateError.bind(this),complete:this.completeSubscription.bind(this)}))},e.prototype.getLoadingResult=function(){return{loading:!0,error:void 0,data:void 0}},e.prototype.updateResult=function(t){this.isMounted&&this.setResult(t)},e.prototype.updateCurrentData=function(t){var s=this.getOptions().onSubscriptionData;this.updateResult({data:t.data,loading:!1,error:void 0}),s&&s({client:this.refreshClient().client,subscriptionData:t})},e.prototype.updateError=function(t){this.updateResult({error:t,loading:!1})},e.prototype.completeSubscription=function(){var t=this.getOptions().onSubscriptionComplete;t&&t(),this.endSubscription()},e.prototype.endSubscription=function(){this.currentObservable.subscription&&(this.currentObservable.subscription.unsubscribe(),delete this.currentObservable.subscription)},e})(M);var q=function(o){m(e,o);function e(t){var s=t.options,n=t.context,u=t.result,i=t.setResult,r=o.call(this,s,n)||this;return r.runMutation=function(a){a===void 0&&(a={}),r.onMutationStart();var l=r.generateNewMutationId();return r.mutate(a).then(function(c){return r.onMutationCompleted(c,l),c}).catch(function(c){if(r.onMutationError(c,l),!r.getOptions().onError)throw c})},r.verifyDocumentType(s.mutation,f.Mutation),r.result=u,r.setResult=i,r.mostRecentMutationId=0,r}return e.prototype.execute=function(t){return this.isMounted=!0,this.verifyDocumentType(this.getOptions().mutation,f.Mutation),[this.runMutation,p(p({},t),{client:this.refreshClient().client})]},e.prototype.afterExecute=function(){return this.isMounted=!0,this.unmount.bind(this)},e.prototype.cleanup=function(){},e.prototype.mutate=function(t){return this.refreshClient().client.mutate(P(this.getOptions(),t))},e.prototype.onMutationStart=function(){!this.result.loading&&!this.getOptions().ignoreResults&&this.updateResult({loading:!0,error:void 0,data:void 0,called:!0})},e.prototype.onMutationCompleted=function(t,s){var n=this.getOptions(),u=n.onCompleted,i=n.ignoreResults,r=t.data,a=t.errors,l=a&&a.length>0?new Q({graphQLErrors:a}):void 0,c=function(){return u?u(r):null};this.isMostRecentMutation(s)&&!i&&this.updateResult({called:!0,loading:!1,data:r,error:l}),c()},e.prototype.onMutationError=function(t,s){var n=this.getOptions().onError;this.isMostRecentMutation(s)&&this.updateResult({loading:!1,error:t,data:void 0,called:!0}),n&&n(t)},e.prototype.generateNewMutationId=function(){return++this.mostRecentMutationId},e.prototype.isMostRecentMutation=function(t){return this.mostRecentMutationId===t},e.prototype.updateResult=function(t){this.isMounted&&(!this.previousResult||!b(this.previousResult,t))&&(this.setResult(t),this.previousResult=t)},e}(M),I=function(o){m(e,o);function e(t){var s=t.options,n=t.context,u=t.onNewData,i=o.call(this,s,n)||this;return i.runLazy=!1,i.previous=Object.create(null),i.runLazyQuery=function(r){i.cleanup(),i.runLazy=!0,i.lazyOptions=r,i.onNewData()},i.getQueryResult=function(){var r=i.observableQueryFields(),a=i.getOptions();if(a.skip)r=p(p({},r),{data:void 0,error:void 0,loading:!1,networkStatus:O.ready,called:!0});else if(i.currentObservable){var l=i.currentObservable.getCurrentResult(),c=l.data,v=l.loading,h=l.partial,C=l.networkStatus,S=l.errors,R=l.error;if(S&&S.length>0&&(R=new Q({graphQLErrors:S})),r=p(p({},r),{data:c,loading:v,networkStatus:C,error:R,called:!0}),!v)if(R)Object.assign(r,{data:(i.currentObservable.getLastResult()||{}).data});else{var E=i.currentObservable.options.fetchPolicy,z=a.partialRefetch;if(z&&h&&(!c||Object.keys(c).length===0)&&E!=="cache-only")return Object.assign(r,{loading:!0,networkStatus:O.loading}),r.refetch(),r}}r.client=i.client,i.setOptions(a,!0);var g=i.previous.result;return i.previous.loading=g&&g.loading||!1,r.previousData=g&&(g.data||g.previousData),i.previous.result=r,i.currentObservable&&i.currentObservable.resetQueryStoreErrors(),r},i.obsRefetch=function(r){var a;return(a=i.currentObservable)===null||a===void 0?void 0:a.refetch(r)},i.obsFetchMore=function(r){return i.currentObservable.fetchMore(r)},i.obsUpdateQuery=function(r){return i.currentObservable.updateQuery(r)},i.obsStartPolling=function(r){var a;(a=i.currentObservable)===null||a===void 0||a.startPolling(r)},i.obsStopPolling=function(){var r;(r=i.currentObservable)===null||r===void 0||r.stopPolling()},i.obsSubscribeToMore=function(r){return i.currentObservable.subscribeToMore(r)},i.onNewData=u,i}return e.prototype.execute=function(){this.refreshClient();var t=this.getOptions(),s=t.skip,n=t.query;return(s||n!==this.previous.query)&&(this.removeQuerySubscription(),this.removeObservable(!s),this.previous.query=n),this.updateObservableQuery(),this.isMounted&&this.startQuerySubscription(),this.getExecuteSsrResult()||this.getExecuteResult()},e.prototype.executeLazy=function(){return this.runLazy?[this.runLazyQuery,this.execute()]:[this.runLazyQuery,{loading:!1,networkStatus:O.ready,called:!1,data:void 0}]},e.prototype.fetchData=function(){var t=this,s=this.getOptions();return s.skip||s.ssr===!1?!1:new Promise(function(n){return t.startQuerySubscription(n)})},e.prototype.afterExecute=function(t){var s=(t===void 0?{}:t).lazy,n=s===void 0?!1:s;return this.isMounted=!0,(!n||this.runLazy)&&this.handleErrorOrCompleted(),this.previousOptions=this.getOptions(),this.unmount.bind(this)},e.prototype.cleanup=function(){this.removeQuerySubscription(),this.removeObservable(!0),delete this.previous.result},e.prototype.getOptions=function(){var t=o.prototype.getOptions.call(this);return this.lazyOptions&&(t.variables=p(p({},t.variables),this.lazyOptions.variables),t.context=p(p({},t.context),this.lazyOptions.context)),this.runLazy&&delete t.skip,t},e.prototype.ssrInitiated=function(){return this.context&&this.context.renderPromises},e.prototype.getExecuteResult=function(){var t=this.getQueryResult();return this.startQuerySubscription(),t},e.prototype.getExecuteSsrResult=function(){var t=this.getOptions(),s=t.ssr,n=t.skip,u=s===!1,i=this.refreshClient().client.disableNetworkFetches,r=p({loading:!0,networkStatus:O.loading,called:!0,data:void 0,stale:!1,client:this.client},this.observableQueryFields());if(u&&(this.ssrInitiated()||i))return this.previous.result=r,r;var a;return this.ssrInitiated()&&(n?a=this.getQueryResult():a=this.context.renderPromises.addQueryPromise(this,this.getQueryResult)||r),a},e.prototype.prepareObservableQueryOptions=function(){var t=this.getOptions();this.verifyDocumentType(t.query,f.Query);var s=t.displayName||"Query";return this.ssrInitiated()&&(t.fetchPolicy==="network-only"||t.fetchPolicy==="cache-and-network")&&(t.fetchPolicy="cache-first"),p(p({},t),{displayName:s,context:t.context})},e.prototype.initializeObservableQuery=function(){if(this.ssrInitiated()&&(this.currentObservable=this.context.renderPromises.getSSRObservable(this.getOptions())),!this.currentObservable){var t=this.prepareObservableQueryOptions();this.previous.observableQueryOptions=p(p({},t),{children:null}),this.currentObservable=this.refreshClient().client.watchQuery(p({},t)),this.ssrInitiated()&&this.context.renderPromises.registerSSRObservable(this.currentObservable,t)}},e.prototype.updateObservableQuery=function(){if(!this.currentObservable){this.initializeObservableQuery();return}if(!this.getOptions().skip){var t=p(p({},this.prepareObservableQueryOptions()),{children:null});b(t,this.previous.observableQueryOptions)||(this.previous.observableQueryOptions=t,this.currentObservable.setOptions(t).catch(function(){}))}},e.prototype.startQuerySubscription=function(t){var s=this;t===void 0&&(t=this.onNewData),!(this.currentSubscription||this.getOptions().skip)&&(this.currentSubscription=this.currentObservable.subscribe({next:function(n){var u=n.loading,i=n.networkStatus,r=n.data,a=s.previous.result;a&&a.loading===u&&a.networkStatus===i&&b(a.data,r)||t()},error:function(n){if(s.resubscribeToQuery(),!n.hasOwnProperty("graphQLErrors"))throw n;var u=s.previous.result;(u&&u.loading||!b(n,s.previous.error))&&(s.previous.error=n,t())}}))},e.prototype.resubscribeToQuery=function(){this.removeQuerySubscription();var t=this.currentObservable;if(t){var s=t.getLastError(),n=t.getLastResult();t.resetLastResults(),this.startQuerySubscription(),Object.assign(t,{lastError:s,lastResult:n})}},e.prototype.handleErrorOrCompleted=function(){if(!(!this.currentObservable||!this.previous.result)){var t=this.previous.result,s=t.data,n=t.loading,u=t.error;if(!n){var i=this.getOptions(),r=i.query,a=i.variables,l=i.onCompleted,c=i.onError,v=i.skip;if(this.previousOptions&&!this.previous.loading&&b(this.previousOptions.query,r)&&b(this.previousOptions.variables,a))return;l&&!u&&!v?l(s):c&&u&&c(u)}}},e.prototype.removeQuerySubscription=function(){this.currentSubscription&&(this.currentSubscription.unsubscribe(),delete this.currentSubscription)},e.prototype.removeObservable=function(t){this.currentObservable&&(this.currentObservable.tearDownQuery(),t&&delete this.currentObservable)},e.prototype.observableQueryFields=function(){var t;return{variables:(t=this.currentObservable)===null||t===void 0?void 0:t.variables,refetch:this.obsRefetch,fetchMore:this.obsFetchMore,updateQuery:this.obsUpdateQuery,startPolling:this.obsStartPolling,stopPolling:this.obsStopPolling,subscribeToMore:this.obsSubscribeToMore}},e}(M);function j(o,e){var t=d.useContext(k()),s=d.useState({called:!1,loading:!1}),n=s[0],u=s[1],i=e?p(p({},e),{mutation:o}):{mutation:o},r=d.useRef();function a(){return r.current||(r.current=new q({options:i,context:t,result:n,setResult:u})),r.current}var l=a();return l.setOptions(i),l.context=t,d.useEffect(function(){return l.afterExecute()}),l.execute(n)}export{I as Q,k as g,j as u};
